import{c as Q,j as e,r as m,k as H,l as J,X as U,m as A}from"./index-CgSx9xry.js";import{b as W,c as Y,d as Z,u as C,a as _,e as ee}from"./header-CDH6kwUi.js";import{m as n,B as l,u as z}from"./Tommy logo-DiWLNgrB.js";import{P as se}from"./progress-DQ5XjpjX.js";import{u as te,V as ae}from"./use-audio-Cjn4WULS.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=Q("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=Q("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);function ne({isCorrect:a,correctAnswer:r,explanation:o,onContinue:N}){return e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs(n.div,{className:"bg-white rounded-2xl shadow-2xl border-4 border-cartoon-yellow max-w-md w-full text-center p-8",children:[e.jsx(n.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.1},className:"flex justify-center mb-4",children:e.jsxs(W,{className:"w-16 h-16 border-4 border-cartoon-teal",children:[e.jsx(Y,{src:"/teacher-tommy.png",alt:"Teacher Tommy"}),e.jsx(Z,{className:"bg-cartoon-yellow text-cartoon-dark text-xl font-bold",children:"ðŸ§‘â€ðŸ«"})]})}),e.jsx(n.div,{initial:{scale:0},animate:{scale:1,rotate:a?360:0},transition:{delay:.2,type:"spring",stiffness:200},className:`w-32 h-32 rounded-full flex items-center justify-center mx-auto mb-4 ${a?"bg-green-500":"bg-red-500"}`,children:a?e.jsx(T,{className:"text-white",size:64}):e.jsx(I,{className:"text-white",size:64})}),a?e.jsxs("div",{children:[e.jsx(n.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200},className:"w-24 h-24 bg-cartoon-mint rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(T,{className:"text-white",size:48})}),e.jsx("h3",{className:"text-2xl font-bold text-cartoon-dark mb-2",children:"Muito bem! ðŸŽ‰"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:['VocÃª acertou! A resposta correta Ã© "',r,'"']}),e.jsx("div",{className:"text-cartoon-mint font-bold text-lg",children:"+10 XP"})]}):e.jsxs("div",{children:[e.jsx(n.div,{initial:{scale:0},animate:{scale:1,rotate:[0,-10,10,-10,0]},transition:{delay:.2,type:"spring",stiffness:200},className:"w-24 h-24 bg-cartoon-red rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(I,{className:"text-white",size:48})}),e.jsx("h3",{className:"text-2xl font-bold text-cartoon-dark mb-2",children:"Ops! Tente novamente ðŸ¤”"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:['A resposta correta Ã© "',r,'"']}),e.jsx("div",{className:"text-cartoon-red font-bold text-lg",children:"Continue tentando!"})]}),o&&e.jsx("div",{className:"mt-4 p-3 bg-cartoon-gray rounded-lg",children:e.jsx("p",{className:"text-sm text-gray-700",children:o})}),e.jsx(l,{onClick:N,className:"cartoon-button mt-6 transform hover:scale-110 transition-all",children:"Continuar"})]})})}function re({results:a,lessonTitle:r,currentLessonId:o,onNextLesson:N,onBackToHome:c}){const u=a.score>=70,{data:d}=C({queryKey:["/api/lessons"]}),{data:x}=C({queryKey:["/api/progress"]}),y=(()=>{if(!d||!(x!=null&&x.progress))return null;const h=[...d].sort((p,b)=>p.id-b.id).find(p=>{const b=x.progress.find(j=>j.lessonId===p.id);return p.id>o&&(!b||!b.completed)});return h?h.id:null})();return e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsxs(n.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"bg-white rounded-2xl shadow-2xl border-4 border-cartoon-yellow max-w-md w-full text-center p-8",children:[e.jsx(n.div,{initial:{scale:0},animate:{scale:1,rotate:360},transition:{delay:.2,type:"spring",stiffness:200,duration:1},className:"w-32 h-32 bg-cartoon-yellow rounded-full flex items-center justify-center mx-auto mb-4 bounce-gentle",children:e.jsx(_,{className:"text-white",size:64})}),e.jsx("h3",{className:"text-3xl font-bold text-cartoon-dark mb-2",children:u?"ParabÃ©ns! ðŸŽŠ":"Quase lÃ¡! ðŸ’ª"}),e.jsx("p",{className:"text-gray-600 mb-4",children:u?`VocÃª completou a liÃ§Ã£o "${r}"`:`Continue praticando a liÃ§Ã£o "${r}"`}),e.jsxs("div",{className:"bg-cartoon-gray rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-cartoon-dark",children:a.correct}),e.jsx("div",{className:"text-sm text-gray-600",children:"Corretas"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-cartoon-red",children:a.incorrect}),e.jsx("div",{className:"text-sm text-gray-600",children:"Incorretas"})]})]}),e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("div",{className:"text-xl font-bold text-cartoon-dark",children:[a.score,"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"PontuaÃ§Ã£o"})]})]}),u&&e.jsxs(n.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.5},className:"bg-cartoon-mint rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"text-3xl font-bold text-white mb-1",children:["+",a.xpEarned," XP"]}),e.jsx("div",{className:"text-cartoon-dark font-semibold",children:"ExperiÃªncia Ganha"})]}),e.jsxs("div",{className:"space-y-3",children:[u?y?e.jsx(l,{onClick:()=>N(y),className:"w-full cartoon-button transform hover:scale-105 transition-all",children:"PrÃ³xima LiÃ§Ã£o"}):e.jsx(l,{onClick:c,className:"w-full cartoon-button transform hover:scale-105 transition-all",children:"ParabÃ©ns! VocÃª completou todas as liÃ§Ãµes!"}):e.jsx(l,{onClick:c,className:"w-full cartoon-button transform hover:scale-105 transition-all",children:"Tentar Novamente"}),e.jsx(l,{onClick:c,variant:"outline",className:"w-full",children:"Voltar ao InÃ­cio"})]})]})})}function xe({lessonId:a,onClose:r}){var P;const[o,N]=m.useState(a),[c,u]=m.useState(0),[d,x]=m.useState(null),[S,y]=m.useState(!1),[q,h]=m.useState(!1),[p,b]=m.useState(null),[j,w]=m.useState({}),[K,M]=m.useState(Date.now());H();const g=J(),{playText:V}=te(),{data:v,isLoading:E}=C({queryKey:[`/api/lessons/${o}`]}),f=(v==null?void 0:v.questions)||[],t=f[c],F=(c+1)/f.length*100,k=z({mutationFn:async s=>(await A("POST","/api/lessons/answer",s)).json(),onSuccess:s=>{w(i=>({...i,[t.id]:s.correct})),y(!0),s.correct&&s.xpEarned>0&&(g.invalidateQueries({queryKey:["/api/user"]}),g.invalidateQueries({queryKey:["/api/progress"]}),g.invalidateQueries({queryKey:["/api/stats/daily"]}))}}),$=z({mutationFn:async s=>(await A("POST","/api/lessons/complete",s)).json(),onSuccess:s=>{const i=Object.values(j).filter(Boolean).length,G=Object.values(j).length-i;b({score:s.score,totalQuestions:f.length,xpEarned:s.xpEarned,correct:i,incorrect:G}),h(!0),g.invalidateQueries({queryKey:["/api/user"]}),g.invalidateQueries({queryKey:["/api/progress"]}),g.invalidateQueries({queryKey:["/api/stats/daily"]})}}),O=s=>{x(s)},B=()=>{!d||!t||k.mutate({lessonId:o,questionId:t.id,answer:d})},L=()=>{if(y(!1),x(null),c<f.length-1)u(s=>s+1);else{const s=Math.round((Date.now()-K)/1e3),i=Object.values(j).filter(Boolean).length;$.mutate({lessonId:o,score:i,totalQuestions:f.length,timeSpent:s})}},X=()=>{w(s=>({...s,[t.id]:!1})),L()},R=()=>{t!=null&&t.question&&V(t.question.replace(/['"]/g,""))},D=s=>{N(s),u(0),x(null),y(!1),h(!1),b(null),w({}),M(Date.now()),window.history.pushState({},"",`/lesson/${s}`)};return E?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cartoon-teal mx-auto"}),e.jsx("p",{className:"mt-4 text-center",children:"Carregando liÃ§Ã£o..."})]})}):!v||f.length===0?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-8 text-center",children:[e.jsx("p",{children:"LiÃ§Ã£o nÃ£o encontrada."}),e.jsx(l,{onClick:r,className:"mt-4",children:"Fechar"})]})}):e.jsx(ee,{children:e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-2 sm:p-4 pt-16 sm:pt-20",children:[e.jsxs(n.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-2xl shadow-2xl border-4 border-cartoon-teal max-w-2xl w-full max-h-[calc(100vh-4rem)] sm:max-h-[calc(100vh-5rem)] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-3 sm:p-6 border-b-2 border-cartoon-gray",children:[e.jsx("h3",{className:"text-lg sm:text-2xl font-bold text-cartoon-dark",children:v.title}),e.jsx(l,{variant:"ghost",size:"sm",onClick:r,className:"text-gray-500 hover:text-gray-700 touch-manipulation",children:e.jsx(U,{size:20,className:"sm:w-6 sm:h-6"})})]}),e.jsxs("div",{className:"p-3 sm:p-6 pb-0",children:[e.jsxs("div",{className:"flex justify-between text-xs sm:text-sm text-gray-600 mb-2",children:[e.jsx("span",{children:"Progresso da LiÃ§Ã£o"}),e.jsxs("span",{children:[c+1," de ",f.length]})]}),e.jsx(se,{value:F,className:"h-2 sm:h-3"})]}),e.jsxs("div",{className:"p-3 sm:p-6",children:[e.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[e.jsx("h4",{className:"text-lg sm:text-xl font-bold text-cartoon-dark mb-2 px-2",children:t==null?void 0:t.question}),e.jsx(l,{variant:"outline",size:"sm",onClick:R,className:"bg-cartoon-blue hover:bg-cartoon-blue/80 text-white border-0 w-10 h-10 rounded-full",children:e.jsx(ae,{size:14,className:"sm:w-4 sm:h-4"})})]}),e.jsx("div",{className:"space-y-3 sm:space-y-4",children:(P=t==null?void 0:t.options)==null?void 0:P.map((s,i)=>e.jsx(n.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>O(s),className:`w-full p-3 sm:p-4 text-left font-semibold rounded-xl border-2 transition-all duration-200 touch-manipulation ${d===s?"border-cartoon-teal bg-cartoon-teal/10 text-cartoon-dark":"border-gray-300 bg-cartoon-gray hover:border-cartoon-teal hover:bg-cartoon-mint/10"}`,children:e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("div",{className:`w-6 h-6 sm:w-8 sm:h-8 rounded-full border-2 flex items-center justify-center text-xs sm:text-sm font-bold ${d===s?"border-cartoon-teal bg-cartoon-teal text-white":"border-gray-400 text-gray-600"}`,children:String.fromCharCode(65+i)}),e.jsx("span",{className:"text-sm sm:text-base",children:s})]})},s))}),e.jsxs("div",{className:"flex justify-between mt-8",children:[e.jsx(l,{variant:"outline",onClick:X,className:"text-gray-600 hover:text-gray-800",children:"Pular"}),e.jsx(l,{onClick:B,disabled:!d||k.isPending,className:"cartoon-button",children:k.isPending?"Verificando...":"Verificar"})]})]})]}),S&&e.jsx(ne,{isCorrect:j[t.id],correctAnswer:t.correctAnswer,explanation:t.explanation,onContinue:L}),q&&p&&e.jsx(re,{results:p,lessonTitle:v.title,currentLessonId:o,onNextLesson:s=>{h(!1),s?D(s):r()},onBackToHome:()=>{h(!1),r()}})]})})}export{T as C,xe as L};
