import{c as q,r as o}from"./index-CgSx9xry.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=q("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);function N(){const[A,t]=o.useState(!1),[p,a]=o.useState(!1),[v,g]=o.useState(""),[M,y]=o.useState(""),[w,l]=o.useState(null),i=o.useRef(null),b=o.useRef(null),f=o.useRef(null),h=o.useCallback(()=>{i.current&&(clearInterval(i.current),i.current=null),b.current&&(clearTimeout(b.current),b.current=null),f.current&&(clearTimeout(f.current),f.current=null)},[]),R=o.useCallback(async(S,D="en-US",k=0,L)=>{if(!("speechSynthesis"in window)){console.warn("Speech synthesis not supported");return}if(console.log("playText called - current state:",{speaking:speechSynthesis.speaking,paused:speechSynthesis.paused,isPlaying:A,isPaused:p,fromPosition:k}),h(),speechSynthesis.speaking||speechSynthesis.paused){console.log("Canceling existing speech synthesis"),speechSynthesis.cancel();let e=0;const d=50;for(;(speechSynthesis.speaking||speechSynthesis.paused)&&e<d;)await new Promise(c=>setTimeout(c,100)),e++;if(await new Promise(c=>setTimeout(c,300)),console.log("After cancel - speechSynthesis state:",{speaking:speechSynthesis.speaking,paused:speechSynthesis.paused,attempts:e}),speechSynthesis.speaking||speechSynthesis.paused){console.warn("Force resetting speech synthesis");for(let c=0;c<3;c++)speechSynthesis.cancel(),await new Promise(n=>setTimeout(n,100))}}const u=S.split(" ").filter(e=>e.trim().length>0),I=u.slice(k).join(" ");if(!I.trim()){console.warn("No text to play");return}g(S),y(I);const s=new SpeechSynthesisUtterance(I);s.lang=D,s.rate=.8,s.pitch=.9,s.volume=1,l(s);const H=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<768||"ontouchstart"in window||navigator.maxTouchPoints>0,U=speechSynthesis.getVoices(),P=U.find(e=>e.lang.includes("en-US")&&(e.name.toLowerCase().includes("male")||e.name.toLowerCase().includes("david")||e.name.toLowerCase().includes("mark")||e.name.toLowerCase().includes("alex")||e.name.toLowerCase().includes("daniel")||e.name.toLowerCase().includes("fred")||e.name.toLowerCase().includes("paul")||e.name.toLowerCase().includes("jorge"))),V=U.find(e=>e.lang.includes("en-US"));if(P?s.voice=P:V&&(s.voice=V),L){let e=0,d=!1;console.log(`Setting up word boundary sync - Words: ${u.length}`);const c=()=>{console.log("Starting word timer fallback for sync");const n=600,r=1/(s.rate||.8),m=n*r;i.current=setInterval(()=>{if(e<u.length&&!speechSynthesis.paused&&speechSynthesis.speaking){const C=k+e,x=u[e]||"";console.log(`Timer highlighting word ${C}: "${x}"`),L(x,C),e++}else(e>=u.length||!speechSynthesis.speaking)&&(console.log("Timer completed or speech stopped"),i.current&&(clearInterval(i.current),i.current=null))},m)};s.onboundary=n=>{if(n.name==="word"){d=!0,f.current&&(clearTimeout(f.current),f.current=null),i.current&&(console.log("Boundary event detected - clearing timer fallback"),clearInterval(i.current),i.current=null);const r=n.charIndex;let m=0,C=0;for(let T=0;T<u.length;T++){if(C+u[T].length>=r){m=T;break}C+=u[T].length+1}const x=k+m;e=m+1,console.log(`Boundary event highlighting word ${x}: "${u[m]||""}"`),L(u[m]||"",x)}},s.onstart=()=>{if(t(!0),a(!1),console.log("Speech started - triggering first word highlight"),L("",k),e=0,d=!1,H)c();else{const n=600*(1/(s.rate||.8));f.current=setTimeout(()=>{!d&&e<=1&&speechSynthesis.speaking&&(console.log("Boundary events not working on desktop, starting timer fallback"),c())},n*.8)}},s.onend=()=>{console.log("Speech ended - cleaning up"),t(!1),a(!1),l(null),g(""),y(""),h()},s.onerror=n=>{if(console.error("Speech synthesis error:",n),n.error==="interrupted"){console.log("Speech interrupted (expected during pause/resume)");return}else n.error==="canceled"?(console.log("Speech canceled - cleaning up state"),h(),t(!1),a(!1),l(null),g(""),y("")):n.error==="synthesis-failed"||n.error==="synthesis-unavailable"?(console.error("Speech synthesis failed:",n.error),h(),t(!1),a(!1),l(null),g(""),y("")):(console.error("Unexpected speech error:",n.error),h(),t(!1),a(!1),l(null),g(""),y(""))}}else s.onstart=()=>{t(!0),a(!1)},s.onend=()=>{t(!1),a(!1),l(null),g(""),y("")},s.onerror=e=>{console.error("Speech synthesis error:",e),t(!1),a(!1),l(null)};const E=()=>{try{speechSynthesis.speak(s)}catch(e){console.error("Error starting speech synthesis:",e),t(!1),l(null)}};if(U.length===0){const e=()=>{const d=speechSynthesis.getVoices(),c=d.find(r=>r.lang.includes("en-US")&&(r.name.toLowerCase().includes("male")||r.name.toLowerCase().includes("david")||r.name.toLowerCase().includes("mark")||r.name.toLowerCase().includes("alex")||r.name.toLowerCase().includes("daniel")||r.name.toLowerCase().includes("fred")||r.name.toLowerCase().includes("paul")||r.name.toLowerCase().includes("jorge"))),n=d.find(r=>r.lang.includes("en-US"));c?s.voice=c:n&&(s.voice=n),E(),speechSynthesis.removeEventListener("voiceschanged",e)};speechSynthesis.addEventListener("voiceschanged",e),b.current=setTimeout(()=>{speechSynthesis.removeEventListener("voiceschanged",e),E()},2e3)}else E()},[h,A,p]),j=o.useCallback(()=>{if(console.log("pauseAudio called - speechSynthesis.speaking:",speechSynthesis.speaking,"speechSynthesis.paused:",speechSynthesis.paused),speechSynthesis.speaking&&!speechSynthesis.paused)try{speechSynthesis.pause(),a(!0),t(!1),console.log("Speech synthesis paused successfully")}catch(S){console.warn("Error pausing speech synthesis:",S),speechSynthesis.cancel(),a(!0),t(!1)}},[]),W=o.useCallback(()=>{if(console.log("resumeAudio called - speechSynthesis.paused:",speechSynthesis.paused,"speechSynthesis.speaking:",speechSynthesis.speaking),console.log("currentUtterance exists:",!!w,"isPaused:",p),w&&p)try{if(speechSynthesis.paused&&speechSynthesis.speaking)console.log("Resuming paused speech synthesis..."),speechSynthesis.resume(),a(!1),t(!0),console.log("Speech synthesis resumed successfully");else if(speechSynthesis.speaking)console.log("Speech synthesis already running"),a(!1),t(!0);else throw console.log("Speech was canceled, cannot resume with current method"),new Error("Speech was canceled, needs restart")}catch(S){throw console.warn("Error resuming speech synthesis:",S),speechSynthesis.cancel(),a(!1),t(!1),l(null),S}else throw console.warn("Cannot resume - no valid paused utterance. currentUtterance:",!!w,"isPaused:",p),new Error("No valid paused utterance to resume")},[w,p]),$=o.useCallback(()=>{console.log("stopAudio called"),h(),speechSynthesis.cancel(),t(!1),a(!1),l(null),g(""),y("")},[h]);return{playText:R,pauseAudio:j,resumeAudio:W,stopAudio:$,isPlaying:A,isPaused:p,currentText:v,remainingText:M,currentUtterance:w}}export{F as V,N as u};
